<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>XlsxWriter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Streaming XLSX Writer</a> &gt; <a href="index.source.html" class="el_package">uk.co.spudsoft.xlsx</a> &gt; <span class="el_source">XlsxWriter.java</span></div><h1>XlsxWriter.java</h1><pre class="source lang-java linenums">/*
 * Copyright (C) 2022 jtalbut
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
package uk.co.spudsoft.xlsx;

import java.io.Closeable;
import java.io.IOException;
import java.io.OutputStream;
import java.math.RoundingMode;
import java.nio.charset.StandardCharsets;
import java.text.DecimalFormat;
import java.time.LocalDate;
import java.time.LocalTime;
import java.time.temporal.ChronoField;
import java.time.temporal.ChronoUnit;
import java.time.temporal.Temporal;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.zip.ZipEntry;
import java.util.zip.ZipOutputStream;

/**
 * Output an XLSX file one row at a time, streaming the output so that it is written as the rows come in.
 * 
 * The Excel file is intended to contain large feeds of data (hence streaming is important) whilst enabling sufficient formatting to look nice.
 * 
 * It is important to note that although the OutputStream class specifies blocking operations, nothing in this class (nor in ZipOutputStream) actually blocks.
 * If the OutputStream passed in to the constructor can be guaranteed to not block then so can this class.
 * 
 * @author jtalbut
 */
@SuppressWarnings(&quot;checkstyle:membername&quot;)
public class XlsxWriter implements Closeable {
  
  /**
   * The default application name that will be reported in the document properties.
   */
  public static final String DEFAULT_APP_NAME = &quot;Streaming XLSX Writer&quot;;
  
  /**
   * The date of the epoch for Excel date values (1 January 1970).
   */
<span class="fc" id="L58">  public static final LocalDate EPOCH_DATE = LocalDate.of(1900, 1, 1);</span>
  
  /**
   * The data of the epoch for Excel time values (midnight).
   */
<span class="fc" id="L63">  public static final LocalTime EPOCH_TIME = LocalTime.of(0, 0);</span>

  /**
   * The font to use if no alternative is specified.
   */
  public static final String DEFAULT_FONT_NAME = &quot;Calibri&quot;;
  
  /**
   * The size of the font to use is not alternative is specified.
   */
  public static final int DEFAULT_FONT_SIZE = 11;
  
<span class="fc" id="L75">  private static final DecimalFormat DATE_FORMAT = prepareDateFormat();</span>
  
  private final TableDefinition defn;
  private final int colCount;
  
<span class="fc" id="L80">  private final String contentTypes = &quot;&lt;Types xmlns=\&quot;http://schemas.openxmlformats.org/package/2006/content-types\&quot;&gt;&lt;Default Extension=\&quot;bin\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings\&quot;/&gt;&lt;Default Extension=\&quot;rels\&quot; ContentType=\&quot;application/vnd.openxmlformats-package.relationships+xml\&quot;/&gt;&lt;Default Extension=\&quot;xml\&quot; ContentType=\&quot;application/xml\&quot;/&gt;&lt;Override PartName=\&quot;/xl/workbook.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml\&quot;/&gt;&lt;Override PartName=\&quot;/xl/worksheets/sheet1.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml\&quot;/&gt;&lt;Override PartName=\&quot;/xl/theme/theme1.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.theme+xml\&quot;/&gt;&lt;Override PartName=\&quot;/xl/styles.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml\&quot;/&gt;&lt;Override PartName=\&quot;/xl/sharedStrings.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml\&quot;/&gt;&lt;Override PartName=\&quot;/docProps/core.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-package.core-properties+xml\&quot;/&gt;&lt;Override PartName=\&quot;/docProps/app.xml\&quot; ContentType=\&quot;application/vnd.openxmlformats-officedocument.extended-properties+xml\&quot;/&gt;&lt;/Types&gt;&quot;;</span>
<span class="fc" id="L81">  private final String rels_rels = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;yes\&quot;?&gt;&lt;Relationships xmlns=\&quot;http://schemas.openxmlformats.org/package/2006/relationships\&quot;&gt;&lt;Relationship Id=\&quot;rId3\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties\&quot; Target=\&quot;docProps/app.xml\&quot;/&gt;&lt;Relationship Id=\&quot;rId2\&quot; Type=\&quot;http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties\&quot; Target=\&quot;docProps/core.xml\&quot;/&gt;&lt;Relationship Id=\&quot;rId1\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument\&quot; Target=\&quot;xl/workbook.xml\&quot;/&gt;&lt;/Relationships&gt;&quot;;</span>
  private final String docProps_app;
  private final String docProps_core;
<span class="fc" id="L84">  private final String xl_rels_workbook = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;yes\&quot;?&gt;&lt;Relationships xmlns=\&quot;http://schemas.openxmlformats.org/package/2006/relationships\&quot;&gt;&lt;Relationship Id=\&quot;rId3\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles\&quot; Target=\&quot;styles.xml\&quot;/&gt;&lt;Relationship Id=\&quot;rId2\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme\&quot; Target=\&quot;theme/theme1.xml\&quot;/&gt;&lt;Relationship Id=\&quot;rId1\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet\&quot; Target=\&quot;worksheets/sheet1.xml\&quot;/&gt;&lt;Relationship Id=\&quot;rId4\&quot; Type=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings\&quot; Target=\&quot;sharedStrings.xml\&quot;/&gt;&lt;/Relationships&gt;&quot;;</span>
  private final String xl_theme_theme1;  
<span class="fc" id="L86">  private final String xl_sharedstrings = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;sst count=\&quot;0\&quot; uniqueCount=\&quot;0\&quot; xmlns=\&quot;http://schemas.openxmlformats.org/spreadsheetml/2006/main\&quot;/&gt;&quot;;</span>
  private final String xl_styles;
  private final String xl_workbook;
<span class="fc" id="L89">  private final String xl_worksheets_sheet1_start = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;worksheet xmlns=\&quot;http://schemas.openxmlformats.org/spreadsheetml/2006/main\&quot;&gt;&lt;sheetViews&gt;&lt;sheetView workbookViewId=\&quot;0\&quot; tabSelected=\&quot;true\&quot;/&gt;&lt;/sheetViews&gt;&lt;sheetFormatPr defaultRowHeight=\&quot;15.0\&quot;/&gt;&quot;;</span>
<span class="fc" id="L90">  private final String xl_worksheets_sheet1_end = &quot;&lt;/sheetData&gt;&lt;pageMargins bottom=\&quot;0.75\&quot; footer=\&quot;0.3\&quot; header=\&quot;0.3\&quot; left=\&quot;0.7\&quot; right=\&quot;0.7\&quot; top=\&quot;0.75\&quot;/&gt;&lt;/worksheet&gt;&quot;;</span>
  
<span class="fc" id="L92">  private Map&lt;String, Integer&gt; numFmtIdMap = new HashMap&lt;&gt;();</span>
  private ZipOutputStream zipout;
<span class="fc" id="L94">  private int r = 0;</span>

  private String coalesce(String value1, String value2) {
<span class="fc bfc" id="L97" title="All 4 branches covered.">    if (value1 == null || value1.isEmpty()) {</span>
<span class="fc" id="L98">      return value2;</span>
    }
<span class="fc" id="L100">    return value1;</span>
  }
  
  /**
   * Constructor.
   * 
   * @param defn The definition of the formatting required in the workbook.
   */
<span class="fc" id="L108">  public XlsxWriter(TableDefinition defn) {</span>
<span class="fc" id="L109">    this.defn = defn;</span>
<span class="fc" id="L110">    this.colCount = defn.columns.size();</span>

<span class="fc" id="L112">    this.docProps_app = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;Properties xmlns=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/extended-properties\&quot;&gt;&lt;Application&gt;&quot; + coalesce(defn.application, DEFAULT_APP_NAME) + &quot;&lt;/Application&gt;&lt;/Properties&gt;&quot;;</span>
<span class="fc" id="L113">    this.docProps_core = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;no\&quot;?&gt;&lt;cp:coreProperties xmlns:cp=\&quot;http://schemas.openxmlformats.org/package/2006/metadata/core-properties\&quot; xmlns:dc=\&quot;http://purl.org/dc/elements/1.1/\&quot; xmlns:dcterms=\&quot;http://purl.org/dc/terms/\&quot; xmlns:xsi=\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot;&gt;&lt;dcterms:created xsi:type=\&quot;dcterms:W3CDTF\&quot;&gt;&quot; + java.time.Instant.now().truncatedTo(java.time.temporal.ChronoUnit.SECONDS).toString() + &quot;&lt;/dcterms:created&gt;&lt;dc:creator&gt;&quot; + coalesce(defn.creator, DEFAULT_APP_NAME) + &quot;&lt;/dc:creator&gt;&lt;/cp:coreProperties&gt;&quot;;</span>
<span class="fc" id="L114">    this.xl_workbook = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;&lt;workbook xmlns=\&quot;http://schemas.openxmlformats.org/spreadsheetml/2006/main\&quot; xmlns:r=\&quot;http://schemas.openxmlformats.org/officeDocument/2006/relationships\&quot;&gt;&lt;workbookPr date1904=\&quot;false\&quot;/&gt;&lt;bookViews&gt;&lt;workbookView activeTab=\&quot;0\&quot;/&gt;&lt;/bookViews&gt;&lt;sheets&gt;&lt;sheet name=\&quot;&quot; + coalesce(defn.name, &quot;Sheet1&quot;) + &quot;\&quot; r:id=\&quot;rId1\&quot; sheetId=\&quot;1\&quot;/&gt;&lt;/sheets&gt;&lt;/workbook&gt;&quot;;</span>
<span class="fc" id="L115">    this.xl_theme_theme1 = buildTheme(defn);</span>
<span class="fc" id="L116">    this.xl_styles = buildStyles(defn);</span>
<span class="fc" id="L117">  }    </span>
  
  /**
   * Start outputting the metadata to the OutputStream.
   * @param stream The output stream that will be written to.
   * @throws IOException if something goes wrong - this should only happen if &quot;stream&quot; throws an exception.
   */
  public void startFile(OutputStream stream) throws IOException {
    // needed objects
    ZipEntry zipentry;
    byte[] data;

    // create ZipOutputStream
<span class="fc" id="L130">    zipout = new ZipOutputStream(stream);</span>

    // create the static parts of the XLSX ZIP file:
<span class="fc" id="L133">    zipentry = new ZipEntry(&quot;[Content_Types].xml&quot;);</span>
<span class="fc" id="L134">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L135">    data = contentTypes.getBytes();</span>
<span class="fc" id="L136">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L137">    zipout.closeEntry();</span>

<span class="fc" id="L139">    zipentry = new ZipEntry(&quot;docProps/app.xml&quot;);</span>
<span class="fc" id="L140">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L141">    data = docProps_app.getBytes();</span>
<span class="fc" id="L142">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L143">    zipout.closeEntry();</span>

<span class="fc" id="L145">    zipentry = new ZipEntry(&quot;docProps/core.xml&quot;);</span>
<span class="fc" id="L146">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L147">    data = docProps_core.getBytes();</span>
<span class="fc" id="L148">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L149">    zipout.closeEntry();</span>

<span class="fc" id="L151">    zipentry = new ZipEntry(&quot;_rels/.rels&quot;);</span>
<span class="fc" id="L152">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L153">    data = rels_rels.getBytes();</span>
<span class="fc" id="L154">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L155">    zipout.closeEntry();</span>

<span class="fc" id="L157">    zipentry = new ZipEntry(&quot;xl/theme/theme1.xml&quot;);</span>
<span class="fc" id="L158">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L159">    data = xl_theme_theme1.getBytes();</span>
<span class="fc" id="L160">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L161">    zipout.closeEntry();</span>

<span class="fc" id="L163">    zipentry = new ZipEntry(&quot;xl/_rels/workbook.xml.rels&quot;);</span>
<span class="fc" id="L164">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L165">    data = xl_rels_workbook.getBytes();</span>
<span class="fc" id="L166">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L167">    zipout.closeEntry();</span>

<span class="fc" id="L169">    zipentry = new ZipEntry(&quot;xl/sharedStrings.xml&quot;);</span>
<span class="fc" id="L170">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L171">    data = xl_sharedstrings.getBytes();</span>
<span class="fc" id="L172">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L173">    zipout.closeEntry();</span>

<span class="fc" id="L175">    zipentry = new ZipEntry(&quot;xl/styles.xml&quot;);</span>
<span class="fc" id="L176">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L177">    data = xl_styles.getBytes();</span>
<span class="fc" id="L178">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L179">    zipout.closeEntry();</span>

<span class="fc" id="L181">    zipentry = new ZipEntry(&quot;xl/workbook.xml&quot;);</span>
<span class="fc" id="L182">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L183">    data = xl_workbook.getBytes();</span>
<span class="fc" id="L184">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L185">    zipout.closeEntry();</span>
    
    // create the xl/worksheets/sheet1.xml
<span class="fc" id="L188">    zipentry = new ZipEntry(&quot;xl/worksheets/sheet1.xml&quot;);</span>
<span class="fc" id="L189">    zipout.putNextEntry(zipentry);</span>
<span class="fc" id="L190">    data = xl_worksheets_sheet1_start.getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L191">    zipout.write(data, 0, data.length);    </span>
    
<span class="fc bfc" id="L193" title="All 2 branches covered.">    if (anyColumnSpecifiesWidth()) {</span>
<span class="fc" id="L194">      outputColumns();</span>
    }
    
<span class="fc" id="L197">    data = &quot;&lt;sheetData&gt;&quot;.getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L198">    zipout.write(data, 0, data.length);    </span>
    
<span class="fc bfc" id="L200" title="All 2 branches covered.">    if (defn.headers) {</span>
<span class="fc" id="L201">      outputHeaders();</span>
    }
<span class="fc" id="L203">  }</span>
  
  boolean anyColumnSpecifiesWidth() {
<span class="fc bfc" id="L206" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">      if (col.width != null) {</span>
<span class="fc" id="L208">        return true;</span>
      }
<span class="fc" id="L210">    }</span>
<span class="fc" id="L211">    return false;</span>
  }
  
  void outputColumns() throws IOException {
<span class="fc" id="L215">    StringBuilder bldr = new StringBuilder();</span>
<span class="fc" id="L216">    bldr.append(&quot;&lt;cols&gt;&quot;);</span>
<span class="fc" id="L217">    int colNum = 0;</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {</span>
<span class="fc" id="L219">      ++colNum;</span>
<span class="fc" id="L220">      Double width = col.width;</span>
<span class="fc bfc" id="L221" title="All 2 branches covered.">      if (width == null) {</span>
<span class="fc" id="L222">        width = 11.0;</span>
      }
<span class="fc" id="L224">      int s = colNum;</span>
<span class="fc" id="L225">      bldr.append(&quot;&lt;col min=\&quot;&quot;).append(colNum).append(&quot;\&quot; max=\&quot;&quot;).append(colNum).append(&quot;\&quot; width=\&quot;&quot;).append(width).append(&quot;\&quot; style=\&quot;&quot;).append(s).append(&quot;\&quot; customWidth=\&quot;1\&quot; /&gt;&quot;);</span>
<span class="fc" id="L226">    }</span>
<span class="fc" id="L227">    bldr.append(&quot;&lt;/cols&gt;&quot;);</span>
    
<span class="fc" id="L229">    byte[] data = bldr.toString().getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L230">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L231">  }</span>
  
  void outputHeaders() throws IOException {
<span class="fc" id="L234">    StringBuilder rowString = new StringBuilder();</span>
<span class="fc" id="L235">    rowString.append(&quot;&lt;row r=\&quot;&quot;).append(++r).append(&quot;\&quot;&gt;&quot;);</span>
    
<span class="fc" id="L237">    int colNum = 0;</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {</span>
<span class="fc" id="L239">      ++colNum;</span>
<span class="fc" id="L240">      int s = 1 + colCount + colNum;</span>
<span class="fc" id="L241">      rowString.append(&quot;&lt;c r=\&quot;&quot;).append(toName(colNum)).append(r).append('&quot;').append(&quot; s=\&quot;&quot;).append(s).append('&quot;');</span>
<span class="fc" id="L242">      rowString.append(&quot; t=\&quot;inlineStr\&quot;&gt;&lt;is&gt;&lt;t&gt;&quot; + encodeSpecialCharacters(coalesce(col.name, &quot;&quot;)) + &quot;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&quot;);</span>
<span class="fc" id="L243">    }</span>
<span class="fc" id="L244">    rowString.append(&quot;&lt;/row&gt;&quot;);</span>

<span class="fc" id="L246">    byte[] data = rowString.toString().getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L247">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L248">  }</span>
  
  static String toName(int number) {
<span class="fc" id="L251">    StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">    while (number-- &gt; 0) {</span>
<span class="fc" id="L253">      sb.append((char) ('A' + (number % 26)));</span>
<span class="fc" id="L254">      number /= 26;</span>
    }
<span class="fc" id="L256">    return sb.reverse().toString();</span>
  }
  
  private static DecimalFormat prepareDateFormat() {
<span class="fc" id="L260">    DecimalFormat df = new DecimalFormat(&quot;#.##################&quot;);</span>
<span class="fc" id="L261">    df.setRoundingMode(RoundingMode.HALF_UP);    </span>
<span class="fc" id="L262">    return df;</span>
  }    

  static String temporalToExcelValue(Temporal ip) {
<span class="fc" id="L266">    boolean hasValue = false;</span>
<span class="fc" id="L267">    double value = 0.0;</span>
<span class="pc bpc" id="L268" title="1 of 4 branches missed.">    if (ip.isSupported(ChronoField.DAY_OF_YEAR) &amp;&amp; ip.isSupported(ChronoField.YEAR)) {</span>
      // Add because Excel date is inclusive at both ends and one based
<span class="fc" id="L270">      value += 2 + ChronoUnit.DAYS.between(EPOCH_DATE, ip);</span>
<span class="fc" id="L271">      hasValue = true;</span>
    }
<span class="fc bfc" id="L273" title="All 2 branches covered.">    if (ip.isSupported(ChronoField.MICRO_OF_DAY)) {</span>
<span class="fc" id="L274">      value += ChronoUnit.MILLIS.between(EPOCH_TIME, ip) / (24.0 * 60 * 60 * 1000);</span>
<span class="fc" id="L275">      hasValue = true;</span>
    }
<span class="fc bfc" id="L277" title="All 2 branches covered.">    if (hasValue) {</span>
<span class="fc" id="L278">      return DATE_FORMAT.format(value);</span>
    } else {
<span class="fc" id="L280">      return ip.toString();</span>
    }
  }
  
  /**
   * Output a row of data to the output stream.
   * 
   * Note that, because of the buffering inherent in ZipOutputStream, this method may not result in a call to OutputStream.write.
   * 
   * The values are handling according to the following rules:
   * &lt;ul&gt;
   * &lt;li&gt;Null values are output as empty cells.
   * &lt;li&gt;String values starting with '=' are output as formulae.
   * &lt;li&gt;Other strings values are output as inline strings.
   * &lt;li&gt;Temporal values are output as numeric values complying with Excel data/time formatting.
   * &lt;li&gt;Number values are output as numeric values.
   * &lt;li&gt;Boolean values are output as boolean values.
   * &lt;li&gt;Anything else is output as an inline string after calling toString() on it.
   * &lt;/ul&gt;
   * 
   * Note that the handling of Temporal values should work for any jsr310 classes (ignoring time zones) but will not work for Date, or SQL Timestamp values.
   * 
   * @param values The values to add to the output, one column at a time.
   * @throws IOException if something goes wrong, this should only happen if the OutputStream throws.
   */
  public void outputRow(List&lt;Object&gt; values) throws IOException {
<span class="fc" id="L306">    StringBuilder rowString = new StringBuilder();</span>
<span class="fc" id="L307">    rowString.append(&quot;&lt;row r=\&quot;&quot;).append(++r).append(&quot;\&quot;&gt;&quot;);</span>
    
<span class="fc" id="L309">    int colNum = 0;</span>
<span class="fc" id="L310">    int colCount = defn.columns.size();</span>
<span class="fc bfc" id="L311" title="All 2 branches covered.">    for (Object cellData : values) {</span>
<span class="fc" id="L312">      ++colNum;</span>
<span class="fc bfc" id="L313" title="All 2 branches covered.">      int s = (2 + r % 2) * (colCount + 1) + (colNum &gt; colCount ? 0 : colNum);</span>
<span class="fc" id="L314">      rowString.append(&quot;&lt;c r=\&quot;&quot;).append(toName(colNum)).append(r).append('&quot;').append(&quot; s=\&quot;&quot;).append(s).append('&quot;');</span>

<span class="fc bfc" id="L316" title="All 2 branches covered.">      if (cellData == null) {</span>
<span class="fc" id="L317">        rowString.append(&quot;&gt;&lt;/c&gt;&quot;);</span>
<span class="fc bfc" id="L318" title="All 2 branches covered.">      } else if (cellData instanceof String) {</span>
<span class="fc" id="L319">        String cellString = (String) cellData;</span>
<span class="fc bfc" id="L320" title="All 2 branches covered.">        if (cellString.startsWith(&quot;=&quot;)) {</span>
<span class="fc" id="L321">          rowString.append(&quot;&gt;&lt;f&gt;&quot; + encodeSpecialCharacters(cellString.substring(1)) + &quot;&lt;/f&gt;&lt;/c&gt;&quot;);</span>
        } else {
<span class="fc" id="L323">          rowString.append(&quot; t=\&quot;inlineStr\&quot;&gt;&lt;is&gt;&lt;t&gt;&quot; + encodeSpecialCharacters(cellString) + &quot;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&quot;);</span>
        }
<span class="fc bfc" id="L325" title="All 2 branches covered.">      } else if (cellData instanceof Temporal) {</span>
<span class="fc" id="L326">        rowString.append(&quot;&gt;&lt;v&gt;&quot;).append(temporalToExcelValue((Temporal) cellData)).append(&quot;&lt;/v&gt;&lt;/c&gt;&quot;);</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">      } else if (cellData instanceof Boolean) {</span>
<span class="fc bfc" id="L328" title="All 2 branches covered.">        rowString.append(&quot; t=\&quot;b\&quot;&gt;&lt;v&gt;&quot;).append((Boolean) cellData ? &quot;1&quot; : &quot;0&quot;).append(&quot;&lt;/v&gt;&lt;/c&gt;&quot;);</span>
<span class="fc bfc" id="L329" title="All 2 branches covered.">      } else if (cellData instanceof Number) {</span>
<span class="fc" id="L330">        rowString.append(&quot;&gt;&lt;v&gt;&quot;).append(cellData.toString()).append(&quot;&lt;/v&gt;&lt;/c&gt;&quot;);</span>
      } else {
<span class="fc" id="L332">        rowString.append(&quot; t=\&quot;inlineStr\&quot;&gt;&lt;is&gt;&lt;t&gt;&quot; + encodeSpecialCharacters(cellData.toString()) + &quot;&lt;/t&gt;&lt;/is&gt;&lt;/c&gt;&quot;);</span>
      }
<span class="fc" id="L334">    }</span>
<span class="fc" id="L335">    rowString.append(&quot;&lt;/row&gt;&quot;);</span>

<span class="fc" id="L337">    byte[] data = rowString.toString().getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L338">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L339">  }</span>

  @Override
  public void close() throws IOException {
<span class="fc" id="L343">    byte[] data = xl_worksheets_sheet1_end.getBytes(StandardCharsets.UTF_8);</span>
<span class="fc" id="L344">    zipout.write(data, 0, data.length);</span>
<span class="fc" id="L345">    zipout.closeEntry();</span>

<span class="fc" id="L347">    zipout.finish();</span>
<span class="fc" id="L348">  }</span>
  
  String buildTheme(TableDefinition defn) {
<span class="fc" id="L351">    StringBuilder bldr = new StringBuilder();</span>
<span class="fc" id="L352">    bldr.append(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;yes\&quot;?&gt;&quot;)</span>
<span class="fc" id="L353">            .append(&quot;&lt;a:theme xmlns:a=\&quot;http://schemas.openxmlformats.org/drawingml/2006/main\&quot; name=\&quot;Office Theme\&quot;&gt;&quot;)</span>

<span class="fc" id="L355">            .append(&quot;&lt;a:themeElements&gt;&quot;)</span>
            
<span class="fc" id="L357">            .append(&quot;&lt;a:clrScheme name=\&quot;Office\&quot;&gt;&quot;)</span>
<span class="fc" id="L358">            .append(&quot;&lt;a:dk1&gt;&lt;a:sysClr val=\&quot;windowText\&quot; lastClr=\&quot;000000\&quot;/&gt;&lt;/a:dk1&gt;&quot;)</span>
<span class="fc" id="L359">            .append(&quot;&lt;a:lt1&gt;&lt;a:sysClr val=\&quot;window\&quot; lastClr=\&quot;FFFFFF\&quot;/&gt;&lt;/a:lt1&gt;&quot;)            </span>
<span class="fc" id="L360">            .append(&quot;&lt;a:dk2&gt;&lt;a:srgbClr val=\&quot;44546A\&quot;/&gt;&lt;/a:dk2&gt;&quot;)            </span>
<span class="fc" id="L361">            .append(&quot;&lt;a:lt2&gt;&lt;a:srgbClr val=\&quot;E7E6E6\&quot;/&gt;&lt;/a:lt2&gt;&quot;)           </span>
<span class="fc" id="L362">            .append(&quot;&lt;a:accent1&gt;&lt;a:srgbClr val=\&quot;4472C4\&quot;/&gt;&lt;/a:accent1&gt;&quot;)            </span>
<span class="fc" id="L363">            .append(&quot;&lt;a:accent2&gt;&lt;a:srgbClr val=\&quot;ED7D31\&quot;/&gt;&lt;/a:accent2&gt;&quot;)</span>
<span class="fc" id="L364">            .append(&quot;&lt;a:accent3&gt;&lt;a:srgbClr val=\&quot;A5A5A5\&quot;/&gt;&lt;/a:accent3&gt;&quot;)</span>
<span class="fc" id="L365">            .append(&quot;&lt;a:accent4&gt;&lt;a:srgbClr val=\&quot;FFC000\&quot;/&gt;&lt;/a:accent4&gt;&quot;)</span>
<span class="fc" id="L366">            .append(&quot;&lt;a:accent5&gt;&lt;a:srgbClr val=\&quot;5B9BD5\&quot;/&gt;&lt;/a:accent5&gt;&quot;)</span>
<span class="fc" id="L367">            .append(&quot;&lt;a:accent6&gt;&lt;a:srgbClr val=\&quot;70AD47\&quot;/&gt;&lt;/a:accent6&gt;&quot;)</span>
<span class="fc" id="L368">            .append(&quot;&lt;a:hlink&gt;&lt;a:srgbClr val=\&quot;0563C1\&quot;/&gt;&lt;/a:hlink&gt;&quot;)</span>
<span class="fc" id="L369">            .append(&quot;&lt;a:folHlink&gt;&lt;a:srgbClr val=\&quot;954F72\&quot;/&gt;&lt;/a:folHlink&gt;&quot;)</span>
<span class="fc" id="L370">            .append(&quot;&lt;/a:clrScheme&gt;&quot;)</span>
            
<span class="fc" id="L372">            .append(&quot;&lt;a:fontScheme name=\&quot;Office\&quot;&gt;&quot;)</span>
<span class="fc" id="L373">            .append(&quot;&lt;a:majorFont&gt;&quot;)</span>
<span class="fc" id="L374">            .append(&quot;&lt;a:latin typeface=\&quot;Calibri Light\&quot; panose=\&quot;020F0302020204030204\&quot;/&gt;&quot;)</span>
<span class="fc" id="L375">            .append(&quot;&lt;a:ea typeface=\&quot;\&quot;/&gt;&lt;a:cs typeface=\&quot;\&quot;/&gt;&quot;)</span>
<span class="fc" id="L376">            .append(&quot;&lt;a:font script=\&quot;Jpan\&quot; typeface=\&quot;游ゴシック Light\&quot;/&gt;&quot;)</span>
<span class="fc" id="L377">            .append(&quot;&lt;a:font script=\&quot;Hang\&quot; typeface=\&quot;맑은 고딕\&quot;/&gt;&quot;)</span>
<span class="fc" id="L378">            .append(&quot;&lt;a:font script=\&quot;Hans\&quot; typeface=\&quot;等线 Light\&quot;/&gt;&quot;)</span>
<span class="fc" id="L379">            .append(&quot;&lt;a:font script=\&quot;Hant\&quot; typeface=\&quot;新細明體\&quot;/&gt;&quot;)</span>
<span class="fc" id="L380">            .append(&quot;&lt;a:font script=\&quot;Arab\&quot; typeface=\&quot;Times New Roman\&quot;/&gt;&quot;)</span>
<span class="fc" id="L381">            .append(&quot;&lt;a:font script=\&quot;Hebr\&quot; typeface=\&quot;Times New Roman\&quot;/&gt;&quot;)</span>
<span class="fc" id="L382">            .append(&quot;&lt;a:font script=\&quot;Thai\&quot; typeface=\&quot;Tahoma\&quot;/&gt;&quot;)</span>
<span class="fc" id="L383">            .append(&quot;&lt;a:font script=\&quot;Ethi\&quot; typeface=\&quot;Nyala\&quot;/&gt;&quot;)</span>
<span class="fc" id="L384">            .append(&quot;&lt;a:font script=\&quot;Beng\&quot; typeface=\&quot;Vrinda\&quot;/&gt;&quot;)</span>
<span class="fc" id="L385">            .append(&quot;&lt;a:font script=\&quot;Gujr\&quot; typeface=\&quot;Shruti\&quot;/&gt;&quot;)</span>
<span class="fc" id="L386">            .append(&quot;&lt;a:font script=\&quot;Khmr\&quot; typeface=\&quot;MoolBoran\&quot;/&gt;&quot;)</span>
<span class="fc" id="L387">            .append(&quot;&lt;a:font script=\&quot;Knda\&quot; typeface=\&quot;Tunga\&quot;/&gt;&quot;)</span>
<span class="fc" id="L388">            .append(&quot;&lt;a:font script=\&quot;Guru\&quot; typeface=\&quot;Raavi\&quot;/&gt;&quot;)</span>
<span class="fc" id="L389">            .append(&quot;&lt;a:font script=\&quot;Cans\&quot; typeface=\&quot;Euphemia\&quot;/&gt;&quot;)</span>
<span class="fc" id="L390">            .append(&quot;&lt;a:font script=\&quot;Cher\&quot; typeface=\&quot;Plantagenet Cherokee\&quot;/&gt;&quot;)</span>
<span class="fc" id="L391">            .append(&quot;&lt;a:font script=\&quot;Yiii\&quot; typeface=\&quot;Microsoft Yi Baiti\&quot;/&gt;&quot;)</span>
<span class="fc" id="L392">            .append(&quot;&lt;a:font script=\&quot;Tibt\&quot; typeface=\&quot;Microsoft Himalaya\&quot;/&gt;&quot;)</span>
<span class="fc" id="L393">            .append(&quot;&lt;a:font script=\&quot;Thaa\&quot; typeface=\&quot;MV Boli\&quot;/&gt;&quot;)</span>
<span class="fc" id="L394">            .append(&quot;&lt;a:font script=\&quot;Deva\&quot; typeface=\&quot;Mangal\&quot;/&gt;&quot;)</span>
<span class="fc" id="L395">            .append(&quot;&lt;a:font script=\&quot;Telu\&quot; typeface=\&quot;Gautami\&quot;/&gt;&quot;)</span>
<span class="fc" id="L396">            .append(&quot;&lt;a:font script=\&quot;Taml\&quot; typeface=\&quot;Latha\&quot;/&gt;&quot;)</span>
<span class="fc" id="L397">            .append(&quot;&lt;a:font script=\&quot;Syrc\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L398">            .append(&quot;&lt;a:font script=\&quot;Orya\&quot; typeface=\&quot;Kalinga\&quot;/&gt;&quot;)</span>
<span class="fc" id="L399">            .append(&quot;&lt;a:font script=\&quot;Mlym\&quot; typeface=\&quot;Kartika\&quot;/&gt;&quot;)</span>
<span class="fc" id="L400">            .append(&quot;&lt;a:font script=\&quot;Laoo\&quot; typeface=\&quot;DokChampa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L401">            .append(&quot;&lt;a:font script=\&quot;Sinh\&quot; typeface=\&quot;Iskoola Pota\&quot;/&gt;&quot;)</span>
<span class="fc" id="L402">            .append(&quot;&lt;a:font script=\&quot;Mong\&quot; typeface=\&quot;Mongolian Baiti\&quot;/&gt;&quot;)</span>
<span class="fc" id="L403">            .append(&quot;&lt;a:font script=\&quot;Viet\&quot; typeface=\&quot;Times New Roman\&quot;/&gt;&quot;)</span>
<span class="fc" id="L404">            .append(&quot;&lt;a:font script=\&quot;Uigh\&quot; typeface=\&quot;Microsoft Uighur\&quot;/&gt;&quot;)</span>
<span class="fc" id="L405">            .append(&quot;&lt;a:font script=\&quot;Geor\&quot; typeface=\&quot;Sylfaen\&quot;/&gt;&quot;)</span>
<span class="fc" id="L406">            .append(&quot;&lt;a:font script=\&quot;Armn\&quot; typeface=\&quot;Arial\&quot;/&gt;&quot;)</span>
<span class="fc" id="L407">            .append(&quot;&lt;a:font script=\&quot;Bugi\&quot; typeface=\&quot;Leelawadee UI\&quot;/&gt;&quot;)</span>
<span class="fc" id="L408">            .append(&quot;&lt;a:font script=\&quot;Bopo\&quot; typeface=\&quot;Microsoft JhengHei\&quot;/&gt;&quot;)</span>
<span class="fc" id="L409">            .append(&quot;&lt;a:font script=\&quot;Java\&quot; typeface=\&quot;Javanese Text\&quot;/&gt;&quot;)</span>
<span class="fc" id="L410">            .append(&quot;&lt;a:font script=\&quot;Lisu\&quot; typeface=\&quot;Segoe UI\&quot;/&gt;&quot;)</span>
<span class="fc" id="L411">            .append(&quot;&lt;a:font script=\&quot;Mymr\&quot; typeface=\&quot;Myanmar Text\&quot;/&gt;&quot;)</span>
<span class="fc" id="L412">            .append(&quot;&lt;a:font script=\&quot;Nkoo\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&quot;)</span>
<span class="fc" id="L413">            .append(&quot;&lt;a:font script=\&quot;Olck\&quot; typeface=\&quot;Nirmala UI\&quot;/&gt;&quot;)</span>
<span class="fc" id="L414">            .append(&quot;&lt;a:font script=\&quot;Osma\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&quot;)</span>
<span class="fc" id="L415">            .append(&quot;&lt;a:font script=\&quot;Phag\&quot; typeface=\&quot;Phagspa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L416">            .append(&quot;&lt;a:font script=\&quot;Syrn\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L417">            .append(&quot;&lt;a:font script=\&quot;Syrj\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L418">            .append(&quot;&lt;a:font script=\&quot;Syre\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&quot;)</span>
<span class="fc" id="L419">            .append(&quot;&lt;a:font script=\&quot;Sora\&quot; typeface=\&quot;Nirmala UI\&quot;/&gt;&quot;)</span>
<span class="fc" id="L420">            .append(&quot;&lt;a:font script=\&quot;Tale\&quot; typeface=\&quot;Microsoft Tai Le\&quot;/&gt;&quot;)</span>
<span class="fc" id="L421">            .append(&quot;&lt;a:font script=\&quot;Talu\&quot; typeface=\&quot;Microsoft New Tai Lue\&quot;/&gt;&quot;)</span>
<span class="fc" id="L422">            .append(&quot;&lt;a:font script=\&quot;Tfng\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&quot;)</span>
<span class="fc" id="L423">            .append(&quot;&lt;/a:majorFont&gt;&quot;)</span>
<span class="fc" id="L424">            .append(&quot;&lt;a:minorFont&gt;&quot;)</span>
<span class="fc" id="L425">            .append(&quot;&lt;a:latin typeface=\&quot;Calibri\&quot; panose=\&quot;020F0502020204030204\&quot;/&gt;&lt;a:ea typeface=\&quot;\&quot;/&gt;&lt;a:cs typeface=\&quot;\&quot;/&gt;&lt;a:font script=\&quot;Jpan\&quot; typeface=\&quot;游ゴシック\&quot;/&gt;&lt;a:font script=\&quot;Hang\&quot; typeface=\&quot;맑은 고딕\&quot;/&gt;&lt;a:font script=\&quot;Hans\&quot; typeface=\&quot;等线\&quot;/&gt;&lt;a:font script=\&quot;Hant\&quot; typeface=\&quot;新細明體\&quot;/&gt;&lt;a:font script=\&quot;Arab\&quot; typeface=\&quot;Arial\&quot;/&gt;&lt;a:font script=\&quot;Hebr\&quot; typeface=\&quot;Arial\&quot;/&gt;&lt;a:font script=\&quot;Thai\&quot; typeface=\&quot;Tahoma\&quot;/&gt;&lt;a:font script=\&quot;Ethi\&quot; typeface=\&quot;Nyala\&quot;/&gt;&lt;a:font script=\&quot;Beng\&quot; typeface=\&quot;Vrinda\&quot;/&gt;&lt;a:font script=\&quot;Gujr\&quot; typeface=\&quot;Shruti\&quot;/&gt;&lt;a:font script=\&quot;Khmr\&quot; typeface=\&quot;DaunPenh\&quot;/&gt;&lt;a:font script=\&quot;Knda\&quot; typeface=\&quot;Tunga\&quot;/&gt;&lt;a:font script=\&quot;Guru\&quot; typeface=\&quot;Raavi\&quot;/&gt;&lt;a:font script=\&quot;Cans\&quot; typeface=\&quot;Euphemia\&quot;/&gt;&lt;a:font script=\&quot;Cher\&quot; typeface=\&quot;Plantagenet Cherokee\&quot;/&gt;&lt;a:font script=\&quot;Yiii\&quot; typeface=\&quot;Microsoft Yi Baiti\&quot;/&gt;&lt;a:font script=\&quot;Tibt\&quot; typeface=\&quot;Microsoft Himalaya\&quot;/&gt;&lt;a:font script=\&quot;Thaa\&quot; typeface=\&quot;MV Boli\&quot;/&gt;&lt;a:font script=\&quot;Deva\&quot; typeface=\&quot;Mangal\&quot;/&gt;&lt;a:font script=\&quot;Telu\&quot; typeface=\&quot;Gautami\&quot;/&gt;&lt;a:font script=\&quot;Taml\&quot; typeface=\&quot;Latha\&quot;/&gt;&lt;a:font script=\&quot;Syrc\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&lt;a:font script=\&quot;Orya\&quot; typeface=\&quot;Kalinga\&quot;/&gt;&lt;a:font script=\&quot;Mlym\&quot; typeface=\&quot;Kartika\&quot;/&gt;&lt;a:font script=\&quot;Laoo\&quot; typeface=\&quot;DokChampa\&quot;/&gt;&lt;a:font script=\&quot;Sinh\&quot; typeface=\&quot;Iskoola Pota\&quot;/&gt;&lt;a:font script=\&quot;Mong\&quot; typeface=\&quot;Mongolian Baiti\&quot;/&gt;&lt;a:font script=\&quot;Viet\&quot; typeface=\&quot;Arial\&quot;/&gt;&lt;a:font script=\&quot;Uigh\&quot; typeface=\&quot;Microsoft Uighur\&quot;/&gt;&lt;a:font script=\&quot;Geor\&quot; typeface=\&quot;Sylfaen\&quot;/&gt;&lt;a:font script=\&quot;Armn\&quot; typeface=\&quot;Arial\&quot;/&gt;&lt;a:font script=\&quot;Bugi\&quot; typeface=\&quot;Leelawadee UI\&quot;/&gt;&lt;a:font script=\&quot;Bopo\&quot; typeface=\&quot;Microsoft JhengHei\&quot;/&gt;&lt;a:font script=\&quot;Java\&quot; typeface=\&quot;Javanese Text\&quot;/&gt;&lt;a:font script=\&quot;Lisu\&quot; typeface=\&quot;Segoe UI\&quot;/&gt;&lt;a:font script=\&quot;Mymr\&quot; typeface=\&quot;Myanmar Text\&quot;/&gt;&lt;a:font script=\&quot;Nkoo\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&lt;a:font script=\&quot;Olck\&quot; typeface=\&quot;Nirmala UI\&quot;/&gt;&lt;a:font script=\&quot;Osma\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&lt;a:font script=\&quot;Phag\&quot; typeface=\&quot;Phagspa\&quot;/&gt;&lt;a:font script=\&quot;Syrn\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&lt;a:font script=\&quot;Syrj\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&lt;a:font script=\&quot;Syre\&quot; typeface=\&quot;Estrangelo Edessa\&quot;/&gt;&lt;a:font script=\&quot;Sora\&quot; typeface=\&quot;Nirmala UI\&quot;/&gt;&lt;a:font script=\&quot;Tale\&quot; typeface=\&quot;Microsoft Tai Le\&quot;/&gt;&lt;a:font script=\&quot;Talu\&quot; typeface=\&quot;Microsoft New Tai Lue\&quot;/&gt;&lt;a:font script=\&quot;Tfng\&quot; typeface=\&quot;Ebrima\&quot;/&gt;&quot;)</span>
<span class="fc" id="L426">            .append(&quot;&lt;/a:minorFont&gt;&quot;)</span>
<span class="fc" id="L427">            .append(&quot;&lt;/a:fontScheme&gt;&quot;)</span>
            
<span class="fc" id="L429">            .append(&quot;&lt;a:fmtScheme name=\&quot;Office\&quot;&gt;&quot;)</span>
<span class="fc" id="L430">            .append(&quot;&lt;a:fillStyleLst&gt;&quot;)</span>
<span class="fc" id="L431">            .append(&quot;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;/&gt;&lt;/a:solidFill&gt;&quot;)</span>
<span class="fc" id="L432">            .append(&quot;&lt;a:gradFill rotWithShape=\&quot;1\&quot;&gt;&lt;a:gsLst&gt;&lt;a:gs pos=\&quot;0\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:lumMod val=\&quot;110000\&quot;/&gt;&lt;a:satMod val=\&quot;105000\&quot;/&gt;&lt;a:tint val=\&quot;67000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;50000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:lumMod val=\&quot;105000\&quot;/&gt;&lt;a:satMod val=\&quot;103000\&quot;/&gt;&lt;a:tint val=\&quot;73000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;100000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:lumMod val=\&quot;105000\&quot;/&gt;&lt;a:satMod val=\&quot;109000\&quot;/&gt;&lt;a:tint val=\&quot;81000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;/a:gsLst&gt;&lt;a:lin ang=\&quot;5400000\&quot; scaled=\&quot;0\&quot;/&gt;&lt;/a:gradFill&gt;&quot;)</span>
<span class="fc" id="L433">            .append(&quot;&lt;a:gradFill rotWithShape=\&quot;1\&quot;&gt;&lt;a:gsLst&gt;&lt;a:gs pos=\&quot;0\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:satMod val=\&quot;103000\&quot;/&gt;&lt;a:lumMod val=\&quot;102000\&quot;/&gt;&lt;a:tint val=\&quot;94000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;50000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:satMod val=\&quot;110000\&quot;/&gt;&lt;a:lumMod val=\&quot;100000\&quot;/&gt;&lt;a:shade val=\&quot;100000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;100000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:lumMod val=\&quot;99000\&quot;/&gt;&lt;a:satMod val=\&quot;120000\&quot;/&gt;&lt;a:shade val=\&quot;78000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;/a:gsLst&gt;&lt;a:lin ang=\&quot;5400000\&quot; scaled=\&quot;0\&quot;/&gt;&lt;/a:gradFill&gt;&quot;)</span>
<span class="fc" id="L434">            .append(&quot;&lt;/a:fillStyleLst&gt;&quot;)</span>
<span class="fc" id="L435">            .append(&quot;&lt;a:lnStyleLst&gt;&quot;)</span>
<span class="fc" id="L436">            .append(&quot;&lt;a:ln w=\&quot;6350\&quot; cap=\&quot;flat\&quot; cmpd=\&quot;sng\&quot; algn=\&quot;ctr\&quot;&gt;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;/&gt;&lt;/a:solidFill&gt;&lt;a:prstDash val=\&quot;solid\&quot;/&gt;&lt;a:miter lim=\&quot;800000\&quot;/&gt;&lt;/a:ln&gt;&quot;)</span>
<span class="fc" id="L437">            .append(&quot;&lt;a:ln w=\&quot;12700\&quot; cap=\&quot;flat\&quot; cmpd=\&quot;sng\&quot; algn=\&quot;ctr\&quot;&gt;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;/&gt;&lt;/a:solidFill&gt;&lt;a:prstDash val=\&quot;solid\&quot;/&gt;&lt;a:miter lim=\&quot;800000\&quot;/&gt;&lt;/a:ln&gt;&quot;)</span>
<span class="fc" id="L438">            .append(&quot;&lt;a:ln w=\&quot;19050\&quot; cap=\&quot;flat\&quot; cmpd=\&quot;sng\&quot; algn=\&quot;ctr\&quot;&gt;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;/&gt;&lt;/a:solidFill&gt;&lt;a:prstDash val=\&quot;solid\&quot;/&gt;&lt;a:miter lim=\&quot;800000\&quot;/&gt;&lt;/a:ln&gt;&quot;)</span>
<span class="fc" id="L439">            .append(&quot;&lt;/a:lnStyleLst&gt;&quot;)            </span>
<span class="fc" id="L440">            .append(&quot;&lt;a:effectStyleLst&gt;&quot;)</span>
<span class="fc" id="L441">            .append(&quot;&lt;a:effectStyle&gt;&lt;a:effectLst/&gt;&lt;/a:effectStyle&gt;&quot;)</span>
<span class="fc" id="L442">            .append(&quot;&lt;a:effectStyle&gt;&lt;a:effectLst/&gt;&lt;/a:effectStyle&gt;&quot;)</span>
<span class="fc" id="L443">            .append(&quot;&lt;a:effectStyle&gt;&lt;a:effectLst&gt;&lt;a:outerShdw blurRad=\&quot;57150\&quot; dist=\&quot;19050\&quot; dir=\&quot;5400000\&quot; algn=\&quot;ctr\&quot; rotWithShape=\&quot;0\&quot;&gt;&lt;a:srgbClr val=\&quot;000000\&quot;&gt;&lt;a:alpha val=\&quot;63000\&quot;/&gt;&lt;/a:srgbClr&gt;&lt;/a:outerShdw&gt;&lt;/a:effectLst&gt;&lt;/a:effectStyle&gt;&quot;)</span>
<span class="fc" id="L444">            .append(&quot;&lt;/a:effectStyleLst&gt;&quot;)</span>
<span class="fc" id="L445">            .append(&quot;&lt;a:bgFillStyleLst&gt;&quot;)</span>
<span class="fc" id="L446">            .append(&quot;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;/&gt;&lt;/a:solidFill&gt;&quot;)</span>
<span class="fc" id="L447">            .append(&quot;&lt;a:solidFill&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:tint val=\&quot;95000\&quot;/&gt;&lt;a:satMod val=\&quot;170000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:solidFill&gt;&quot;)</span>
<span class="fc" id="L448">            .append(&quot;&lt;a:gradFill rotWithShape=\&quot;1\&quot;&gt;&lt;a:gsLst&gt;&lt;a:gs pos=\&quot;0\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:tint val=\&quot;93000\&quot;/&gt;&lt;a:satMod val=\&quot;150000\&quot;/&gt;&lt;a:shade val=\&quot;98000\&quot;/&gt;&lt;a:lumMod val=\&quot;102000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;50000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:tint val=\&quot;98000\&quot;/&gt;&lt;a:satMod val=\&quot;130000\&quot;/&gt;&lt;a:shade val=\&quot;90000\&quot;/&gt;&lt;a:lumMod val=\&quot;103000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;a:gs pos=\&quot;100000\&quot;&gt;&lt;a:schemeClr val=\&quot;phClr\&quot;&gt;&lt;a:shade val=\&quot;63000\&quot;/&gt;&lt;a:satMod val=\&quot;120000\&quot;/&gt;&lt;/a:schemeClr&gt;&lt;/a:gs&gt;&lt;/a:gsLst&gt;&lt;a:lin ang=\&quot;5400000\&quot; scaled=\&quot;0\&quot;/&gt;&lt;/a:gradFill&gt;&quot;)</span>
<span class="fc" id="L449">            .append(&quot;&lt;/a:bgFillStyleLst&gt;&quot;)</span>
<span class="fc" id="L450">            .append(&quot;&lt;/a:fmtScheme&gt;&quot;)</span>
            
<span class="fc" id="L452">            .append(&quot;&lt;/a:themeElements&gt;&quot;)</span>
            
<span class="fc" id="L454">            .append(&quot;&lt;a:objectDefaults/&gt;&quot;)</span>
<span class="fc" id="L455">            .append(&quot;&lt;a:extraClrSchemeLst/&gt;&quot;)</span>
<span class="fc" id="L456">            .append(&quot;&lt;a:extLst&gt;&lt;a:ext uri=\&quot;{05A4C25C-085E-4340-85A3-A5531E510DB2}\&quot;&gt;&lt;thm15:themeFamily xmlns:thm15=\&quot;http://schemas.microsoft.com/office/thememl/2012/main\&quot; name=\&quot;Office Theme\&quot; id=\&quot;{62F939B6-93AF-4DB8-9C6B-D6C7DFDC589F}\&quot; vid=\&quot;{4A3C46E8-61CC-4603-A589-7422A47A8E4A}\&quot;/&gt;&lt;/a:ext&gt;&lt;/a:extLst&gt;&quot;)</span>
            
<span class="fc" id="L458">            .append(&quot;&lt;/a:theme&gt;&quot;);</span>
<span class="fc" id="L459">    return bldr.toString();</span>
  }
  
  private void appendFont(StringBuilder bldr, FontDefinition fontDefn, ColourDefinition colourDefn) {
<span class="fc" id="L463">    bldr.append(&quot;&lt;font&gt;&lt;sz val=\&quot;&quot;);</span>
<span class="fc bfc" id="L464" title="All 2 branches covered.">    bldr.append(fontDefn == null ? DEFAULT_FONT_SIZE : fontDefn.size);</span>
<span class="fc" id="L465">    bldr.append(&quot;\&quot;/&gt;&quot;);</span>
<span class="fc bfc" id="L466" title="All 4 branches covered.">    if (colourDefn != null &amp;&amp; colourDefn.fgColour != null) {</span>
<span class="fc" id="L467">      bldr.append(&quot;&lt;color rgb=\&quot;&quot;).append(colourDefn.fgColour).append(&quot;\&quot; /&gt;&quot;);</span>
    }
<span class="fc" id="L469">    bldr.append(&quot;&lt;name val=\&quot;&quot;);</span>
<span class="fc bfc" id="L470" title="All 4 branches covered.">    bldr.append(fontDefn == null || fontDefn.typeface == null ? DEFAULT_FONT_NAME : fontDefn.typeface);</span>
<span class="fc" id="L471">    bldr.append(&quot;\&quot;/&gt;&lt;/font&gt;&quot;);</span>
<span class="fc" id="L472">  }</span>
      
  private void appendFill(StringBuilder bldr, ColourDefinition colourDefn) {
<span class="fc bfc" id="L475" title="All 4 branches covered.">    if (colourDefn != null &amp;&amp; colourDefn.bgColour != null) {</span>
<span class="fc" id="L476">      bldr.append(&quot;&lt;fill&gt;&lt;patternFill patternType=\&quot;solid\&quot;&gt;&lt;fgColor rgb=\&quot;&quot;).append(colourDefn.bgColour).append(&quot;\&quot; /&gt;&lt;bgColor indexed=\&quot;64\&quot;/&gt;&lt;/patternFill&gt;&lt;/fill&gt;&quot;);</span>
    } else {
<span class="fc" id="L478">      bldr.append(&quot;&lt;fill&gt;&lt;patternFill patternType=\&quot;none\&quot;/&gt;&lt;/fill&gt;&quot;);      </span>
    }
<span class="fc" id="L480">  }</span>

  static String encodeSpecialCharacters(String input) {
<span class="fc" id="L483">    return input.replaceAll(&quot;&amp;&quot;, &quot;&amp;amp;&quot;).replaceAll(&quot;&lt;&quot;, &quot;&amp;lt;&quot;);</span>
  }
  
  String buildStyles(TableDefinition defn) {
<span class="fc" id="L487">    StringBuilder bldr = new StringBuilder();</span>
<span class="fc" id="L488">    bldr.append(&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;yes\&quot;?&gt;&lt;styleSheet xmlns=\&quot;http://schemas.openxmlformats.org/spreadsheetml/2006/main\&quot; xmlns:mc=\&quot;http://schemas.openxmlformats.org/markup-compatibility/2006\&quot; mc:Ignorable=\&quot;x14ac x16r2 xr\&quot; xmlns:x14ac=\&quot;http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac\&quot; xmlns:x16r2=\&quot;http://schemas.microsoft.com/office/spreadsheetml/2015/02/main\&quot; xmlns:xr=\&quot;http://schemas.microsoft.com/office/spreadsheetml/2014/revision\&quot;&gt;&quot;);</span>
<span class="fc" id="L489">    buildNumFmts(numFmtIdMap, bldr, defn);</span>

<span class="fc" id="L491">    bldr.append(&quot;&lt;fonts count=\&quot;4\&quot;&gt;&quot;);    </span>
<span class="fc" id="L492">    appendFont(bldr, defn.bodyFont, null);</span>
<span class="fc" id="L493">    appendFont(bldr, defn.headerFont, defn.headerColours);</span>
<span class="fc" id="L494">    appendFont(bldr, defn.bodyFont, defn.evenColours);</span>
<span class="fc" id="L495">    appendFont(bldr, defn.bodyFont, defn.oddColours);</span>
<span class="fc" id="L496">    bldr.append(&quot;&lt;/fonts&gt;&quot;);</span>

<span class="fc" id="L498">    bldr.append(&quot;&lt;fills count=\&quot;5\&quot;&gt;&quot;);</span>
<span class="fc" id="L499">    bldr.append(&quot;&lt;fill&gt;&lt;patternFill patternType=\&quot;none\&quot;/&gt;&lt;/fill&gt;&quot;);</span>
<span class="fc" id="L500">    bldr.append(&quot;&lt;fill&gt;&lt;patternFill patternType=\&quot;gray125\&quot;/&gt;&lt;/fill&gt;&quot;);</span>
<span class="fc" id="L501">    appendFill(bldr, defn.headerColours);</span>
<span class="fc" id="L502">    appendFill(bldr, defn.evenColours);</span>
<span class="fc" id="L503">    appendFill(bldr, defn.oddColours);</span>
<span class="fc" id="L504">    bldr.append(&quot;&lt;/fills&gt;&quot;);</span>
    
<span class="fc" id="L506">    bldr.append(&quot;&lt;borders count=\&quot;2\&quot;&gt;&quot;);</span>
<span class="fc" id="L507">    bldr.append(&quot;&lt;border&gt;&lt;left/&gt;&lt;right/&gt;&lt;top/&gt;&lt;bottom/&gt;&lt;diagonal/&gt;&lt;/border&gt;&quot;);</span>
<span class="fc" id="L508">    bldr.append(&quot;&lt;border&gt;&lt;left style=\&quot;thin\&quot;&gt;&lt;color indexed=\&quot;64\&quot;/&gt;&lt;/left&gt;&lt;right style=\&quot;thin\&quot;&gt;&lt;color indexed=\&quot;64\&quot;/&gt;&lt;/right&gt;&lt;top style=\&quot;thin\&quot;&gt;&lt;color indexed=\&quot;64\&quot;/&gt;&lt;/top&gt;&lt;bottom style=\&quot;thin\&quot;&gt;&lt;color indexed=\&quot;64\&quot;/&gt;&lt;/bottom&gt;&lt;diagonal/&gt;&lt;/border&gt;&quot;);</span>
<span class="fc" id="L509">    bldr.append(&quot;&lt;/borders&gt;&quot;);</span>
        
<span class="fc" id="L511">    bldr.append(&quot;&lt;cellStyleXfs count=\&quot;1\&quot;&gt;&quot;);</span>
<span class="fc" id="L512">    bldr.append(&quot;&lt;xf numFmtId=\&quot;0\&quot; fontId=\&quot;0\&quot; fillId=\&quot;0\&quot; borderId=\&quot;0\&quot;/&gt;&quot;);</span>
<span class="fc" id="L513">    bldr.append(&quot;&lt;/cellStyleXfs&gt;&quot;);</span>

<span class="fc" id="L515">    bldr.append(&quot;&lt;cellXfs count=\&quot;17\&quot;&gt;&quot;);</span>

    // Default format
<span class="fc" id="L518">    bldr.append(&quot;&lt;xf numFmtId=\&quot;0\&quot; fontId=\&quot;0\&quot; fillId=\&quot;0\&quot; borderId=\&quot;0\&quot; xfId=\&quot;0\&quot;/&gt;&quot;);   </span>
    
<span class="fc bfc" id="L520" title="All 2 branches covered.">    int borderId = defn.gridLines ? 1 : 0;</span>
    // Column formats   
<span class="fc bfc" id="L522" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {      </span>
<span class="fc bfc" id="L523" title="All 2 branches covered.">      int numFmt = col.format != null ? this.numFmtIdMap.get(col.format) : 0;</span>
<span class="fc" id="L524">      bldr.append(&quot;&lt;xf numFmtId=\&quot;&quot;).append(numFmt).append(&quot;\&quot; fontId=\&quot;0\&quot; fillId=\&quot;0\&quot; borderId=\&quot;0\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; /&gt;&quot;);         </span>
<span class="fc" id="L525">    }</span>
    
    // Header
<span class="fc" id="L528">    bldr.append(&quot;&lt;xf fontId=\&quot;1\&quot; fillId=\&quot;2\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc bfc" id="L529" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {      </span>
<span class="fc bfc" id="L530" title="All 2 branches covered.">      int numFmt = col.format != null ? this.numFmtIdMap.get(col.format) : 0;</span>
<span class="fc" id="L531">      bldr.append(&quot;&lt;xf numFmtId=\&quot;&quot;).append(numFmt).append(&quot;\&quot; fontId=\&quot;1\&quot; fillId=\&quot;2\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc" id="L532">    }</span>
    
    // Even Rows
<span class="fc" id="L535">      bldr.append(&quot;&lt;xf fontId=\&quot;2\&quot; fillId=\&quot;3\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc bfc" id="L536" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {      </span>
<span class="fc bfc" id="L537" title="All 2 branches covered.">      int numFmt = col.format != null ? this.numFmtIdMap.get(col.format) : 0;</span>
<span class="fc" id="L538">      bldr.append(&quot;&lt;xf numFmtId=\&quot;&quot;).append(numFmt).append(&quot;\&quot; fontId=\&quot;2\&quot; fillId=\&quot;3\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc" id="L539">    }</span>

    // Odd Rows
<span class="fc" id="L542">    bldr.append(&quot;&lt;xf fontId=\&quot;3\&quot; fillId=\&quot;4\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc bfc" id="L543" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {      </span>
<span class="fc bfc" id="L544" title="All 2 branches covered.">      int numFmt = col.format != null ? this.numFmtIdMap.get(col.format) : 0;</span>
<span class="fc" id="L545">      bldr.append(&quot;&lt;xf numFmtId=\&quot;&quot;).append(numFmt).append(&quot;\&quot; fontId=\&quot;3\&quot; fillId=\&quot;4\&quot; borderId=\&quot;&quot;).append(borderId).append(&quot;\&quot; xfId=\&quot;0\&quot; applyNumberFormat=\&quot;1\&quot; applyFont=\&quot;1\&quot; applyFill=\&quot;1\&quot; applyBorder=\&quot;1\&quot;/&gt;&quot;);</span>
<span class="fc" id="L546">    }</span>
    
<span class="fc" id="L548">    bldr.append(&quot;&lt;/cellXfs&gt;&quot;);</span>
    
<span class="fc" id="L550">    bldr.append(&quot;&lt;cellStyles count=\&quot;1\&quot;&gt;&quot;);</span>
<span class="fc" id="L551">    bldr.append(&quot;&lt;cellStyle name=\&quot;Normal\&quot; xfId=\&quot;0\&quot; builtinId=\&quot;0\&quot;/&gt;&quot;);</span>
<span class="fc" id="L552">    bldr.append(&quot;&lt;/cellStyles&gt;&quot;);</span>
    
<span class="fc" id="L554">    bldr.append(&quot;&lt;dxfs count=\&quot;0\&quot;/&gt;&quot;);</span>
    
<span class="fc" id="L556">    bldr.append(&quot;&lt;tableStyles count=\&quot;0\&quot; defaultTableStyle=\&quot;TableStyleMedium2\&quot; defaultPivotStyle=\&quot;PivotStyleLight16\&quot;/&gt;&quot;);</span>

<span class="fc" id="L558">    bldr.append(&quot;&lt;/styleSheet&gt;&quot;);</span>
<span class="fc" id="L559">    return bldr.toString();</span>
  }

  static void buildNumFmts(Map&lt;String, Integer&gt; numFmtIdMap, StringBuilder bldr, TableDefinition defn) {
<span class="fc" id="L563">    List&lt;String&gt; numFmts = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L564" title="All 2 branches covered.">    for (ColumnDefinition col : defn.columns) {</span>
<span class="fc bfc" id="L565" title="All 2 branches covered.">      if (col.format != null) {</span>
<span class="fc bfc" id="L566" title="All 2 branches covered.">        if (!numFmts.contains(col.format)) {</span>
<span class="fc" id="L567">          numFmts.add(col.format);</span>
        }
      }
<span class="fc" id="L570">    }</span>
<span class="fc bfc" id="L571" title="All 2 branches covered.">    if (!numFmts.isEmpty()) {</span>
<span class="fc" id="L572">      bldr.append(&quot;&lt;numFmts count=\&quot;&quot;).append(numFmts.size()).append(&quot;\&quot;&gt;&quot;);</span>
<span class="fc" id="L573">      int id = 165;</span>
<span class="fc bfc" id="L574" title="All 2 branches covered.">      for (String fmt : numFmts) {</span>
<span class="fc" id="L575">        bldr.append(&quot;&lt;numFmt numFmtId=\&quot;&quot;).append(id).append(&quot;\&quot; formatCode=\&quot;&quot;).append(fmt).append(&quot;\&quot;/&gt;&quot;);      </span>
<span class="fc" id="L576">        numFmtIdMap.put(fmt, id++);</span>
<span class="fc" id="L577">      }</span>
<span class="fc" id="L578">      bldr.append(&quot;&lt;/numFmts&gt;&quot;);</span>
    }
<span class="fc" id="L580">  }</span>
  
  
  
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>